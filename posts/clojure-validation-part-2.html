
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Digital Tapestry - Clojure Validation - Part II</title>
        <meta name="description" content="Weaving a Digital Tapestry" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Digital Tapestry" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="Digital Tapestry" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Digital Tapestry" />
        <meta name="msapplication-tooltip" content="Digital Tapestry" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Digital Tapestry - Clojure Validation - Part II" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://digitaltapestry.net/posts/clojure-validation-part-2" />
        <!-- TODO: More social graph meta tags -->

        <script src="/assets/js/jquery.min.js"></script>
        <script src="/assets/js/bootstrap.min.js"></script>     
        <script src="/assets/js/highlight.pack.js"></script>   
        <script src="/assets/js/clean-blog.js"></script>
        <script src="/assets/js/d3.v3.min.js"></script>
        <script src="/assets/js/trianglify.min.js"></script>
        <script src="/assets/js/Please-compressed.js"></script>
        <script src="/assets/js/background-check.min.js"></script>
                
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
                <script src="/assets/js/html5shiv.js"></script>
                <script src="/assets/js/respond.min.js"></script>
        <![endif]-->
        
        <link href="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.css" rel="stylesheet" type="text/css">
<link href="/assets/css/overrides.css" rel="stylesheet" />



        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Digital Tapestry</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/resume">Resume</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header" style="background-image: url(&quot;/assets/images/banner_web.jpg&quot;)">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Clojure Validation - Part II</h1>
    <div class="meta">        
Published on Tuesday, August 21, 2018<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/Clojure" class="btn btn-default btn-xs">Clojure</a>
                    <a role="button" href="/tags/ClojureScript" class="btn btn-default btn-xs">ClojureScript</a>
                    <a role="button" href="/tags/Reagent" class="btn btn-default btn-xs">Reagent</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<h1 id="clojure-validation-part-ii">Clojure Validation - Part II</h1>
<h3 id="ui-validation">UI Validation</h3>
<blockquote class="blockquote">
<p>Nothing clears up a case so much as stating it to another person.</p>
<footer>Sherlock Holmes</footer>
</blockquote>
<p>Last time we used Clojure Spec to build up some validation predicates to ensure we have a valid SSN. This time around we're going to tie this to some Reagent components to use in our Web UI, giving feedback to the user when they enter bad data.</p>
<p>Full series:</p>
<ul>
<li><a href="/posts/clojure-validation-part-1">Part I - Clojure Spec</a></li>
<li>Part II - UI Validation (this post)</li>
<li><a href="/posts/clojure-validation-part-3">Part III - Better Messages with Phrase</a></li>
<li><a href="/posts/clojure-validation-part-4">Part IV - I18N</a></li>
</ul>
<h2 id="final-result">Final Result</h2>
<p>Here's an embedded example of the final result we're going to get after this blog post.</p>
<div id="app"><p>Enable JavaScript to see the example.</p>
</div>
<div class="alert alert-info"><p>This is only the look and behavior at the end of this post, and not the final result we'll get working through this series!</p>
</div>
<h2 id="a-much-simpler-core">A Much Simpler Core</h2>
<p>The generated <code>core.cljs</code> file we have currently, while not really complex, is far more complex then we need for this experiment. It's a SPA page with navigation, and frankly we don't need that. In fact, I'm wanting to generate a script that I can use to embed in this blog post, so we really want something simple here. This is what we'll start with.</p>
<pre><code class="language-Clojure">(ns validation-experiment.core
  (:require [reagent.core :as reagent :refer [atom]]))

(defn example []
  [:div [:label &quot;Enter SSN: &quot; [:input {:type :text}]]])

(defn mount-root []
  (reagent/render [example] (.getElementById js/document &quot;app&quot;)))

(defn init! []
  (mount-root))
</code></pre>
<p>This produces (inside an existing DOM element with an &ldquo;app&rdquo; id) a simple label and a text input box. Oh the magnificence!</p>
<p>You can view this wonder using Figwheel by executing the following.</p>
<pre><code class="language-PowerShell">PS&gt; lein figwheel
</code></pre>
<p>Now open a browser and navigate to <a href="http://localhost:3449">http://localhost:3449</a> to behold the results of our hard work.</p>
<p>If you're not familiar with <a href="https://github.com/bhauman/lein-figwheel">Figwheel</a> it &quot; builds your ClojureScript code and hot loads it into the browser as you are coding!&quot; So, don't stop it or close that browser. As we change our code and save it your browser will magically update with the changes live, current state intact. This is an unbelievable bit of tech that makes coding stuff like this a dream.</p>
<h2 id="adding-state">Adding State</h2>
<p>So, we have a text input box, but there's no state backing it. Let's fix that by changing a bit of the code.</p>
<pre><code class="language-Clojure">(defonce ssn (atom &quot;123-45-6789&quot;))

(defn example []
  [:div [:label &quot;Enter SSN: &quot; [:input {:type :text :value &#64;ssn :on-change #(reset! ssn (-&gt; % .-target .-value))}]]])
</code></pre>
<p>We've defined an <code>ssn</code> variable as an <code>atom</code> with the value &ldquo;123-45-6789&rdquo;. A <a href="https://clojure.org/reference/atoms">Clojure atom</a> provides &quot;a way to manage shared, synchronous, independent state.&quot; In this case, this is actually a <a href="https://reagent-project.github.io/">Reagent atom</a>. &ldquo;It works exactly like the one in clojure.core, except that it keeps track of every time it is deref’ed. Any component that uses an atom is automagically re-rendered when its value changes.&rdquo; This is really the magic that makes Reagent work here, though with just what we have right now you will be forgiven for not seeing any magic.</p>
<h2 id="adding-validation">Adding Validation</h2>
<p>Let's see that magic in use! We'll add validation to our control using Clojure Spec and the code we wrote last time. We're going to need access to a few more namespaces.</p>
<pre><code class="language-Clojure">(ns validation-experiment.core
  (:require [reagent.core :as reagent :refer [atom]]
            [validation-experiment.ssn :as ssn]
            [clojure.spec.alpha :as s]))
</code></pre>
<p>Now, we can get automatic display of validation results with the following simple change.</p>
<pre><code class="language-Clojure">(defn example []
  [:div [:label &quot;Enter SSN: &quot; [:input {:type :text :value &#64;ssn :on-change #(reset! ssn (-&gt; % .-target .-value))}]]
   [:p {:style {:color &quot;red&quot;}} (str (s/explain-data :validation-experiment.ssn/ssn &#64;ssn))]])
</code></pre>
<p>We've added a <code>p</code> tag, styled it to display in red, and populated it with the results of <code>s/explain-data</code> rendered as a string. Last time we used <code>s/explain</code>, so this shouldn't be too unfamilar. The difference between <code>s/explain</code> and <code>s/explain-data</code> is that the former just writes the results to the output (not very helpful in a web page) while the latter returns those results as a Clojure map, which we rendered as a string to include in our paragraph.</p>
<p>Play around a bit with the result, entering different values into the text box. See how the validation display changes as you type? Notice that it disappears entirely when you've entered a valid SSN? The live updates are the magic of Reagent and it's atom, while having the validation message dissapear is a result of how Reagent handles <code>nil</code>. When <code>s/explain-data</code> returns <code>nil</code> for valid input Reagent actually removes it from the child list.</p>
<p>Look at how super simple it was to get validation in Reagent using Clojure Spec!</p>
<p>Oh, but the validation message displayed is really ugly you say? Well, yes, yes it is. We'll fix that in the <a href="/posts/clojure-validation-part-3">next part</a> of this series.</p>
<div class="alert alert-success"><p>The code for this part of the series can be found in the branch <code>part2</code> in the associated repo at <a href="https://github.com/wekempf/validation-experiment.">https://github.com/wekempf/validation-experiment.</a></p>
</div>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'digitaltapestry'; // required: replace example with your forum shortname
    var disqus_identifier = 'clojure-validation-part-2';
    var disqus_title = 'Clojure Validation - Part II';
    var disqus_url = 'https://digitaltapestry.net/posts/clojure-validation-part-2';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
    <div class="row">
        <div class="col-md-12">
            <ul class="list-inline text-center">
                <li>
                    <a href="https://twitter.com/wekempf">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                        </span>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/wekempf">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                        </span>
                    </a>
                </li>
            </ul>
            <p class="copyright text-muted">
                Copyright © 2018 by William E. Kempf. The opinions expressed herein are my own and do not represent those of my employer or any other third-party views in any way.
                <br />
                This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                <br />
                <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                <br />
                <a href="https://github.com/wekempf/wekempf.github.io"><i class="fa fa-github"></i> This Site on GitHub</a>
                <br />
                Hosted on <a href="https://pages.github.com/">GitHub Pages</a>
                <br />
                <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
            </p>
        </div>
    </div>
</div>
                </footer> 

                <script src="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.16/clipboard.min.js"></script>
<script type="text/javascript">
    anchors.options.placement = 'left';
    anchors.add('#content > h1,h2,h3,h4');

    var snippets = document.querySelectorAll("pre > code");
    [].forEach.call(snippets, function(snippet) {
        snippet.insertAdjacentHTML("beforebegin", "<button class='btn-copy' data-clipboard-snippet><img class='clippy' width=13 src='/assets/images/clippy.svg' alt='Copy to clipboard'></button>");
    });
    var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
        target: function(trigger) {
            return trigger.nextElementSibling;
        }
    });
    clipboardSnippets.on('success', function(e) {
        e.clearSelection();
        showTooltip(e.trigger, "Copied!");
    });
    clipboardSnippets.on('error', function(e) {
        showTooltip(e.trigger, fallbackMessage(e.action));
    });

    var btns = document.querySelectorAll('.btn-copy');
    for (var i = 0; i < btns.length; i++) {
        btns[i].addEventListener('mouseleave', function(e) {
            e.currentTarget.setAttribute('class', 'btn-copy');
            e.currentTarget.removeAttribute('aria-label');
        });
    }

    function showTooltip(elem, msg) {
        elem.setAttribute('class', 'btn-copy tooltipped tooltipped-s');
        elem.setAttribute('aria-label', msg);
    }

    function fallbackMessage(action) {
        var actionMsg = '';
        var actionKey = (action === 'cut' ? 'X' : 'C');
        if (/iPhone|iPad/i.test(navigator.userAgent)) {
            actionMsg = 'No support :(';
        } else if (/Mac/i.test(navigator.userAgent)) {
            actionMsg = 'Press ⌘-' + actionKey + ' to ' + action;
        } else {
            actionMsg = 'Press Ctrl-' + actionKey + ' to ' + action;
        }
        return actionMsg;
    }
    hljs.initHighlightingOnLoad();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70929529-2', 'auto');
  ga('send', 'pageview');
</script>
<script type="text/javascript" src="/assets/scripts/clojure-validation-part-2/app.js"></script>

                <script>hljs.initHighlightingOnLoad();</script>


                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

