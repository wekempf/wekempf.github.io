
<!DOCTYPE html>
<html lang="en">
        <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>

        <title>Digital Tapestry - Understanding Task - Part I</title>
        <meta name="description" content="Weaving a Digital Tapestry" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0">        

        <link type="application/rss+xml" rel="alternate" title="Digital Tapestry" href="/feed.rss" />
                <link type="application/atom+xml" rel="alternate" title="Digital Tapestry" href="/feed.atom" />
        <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
        <link rel="icon" href="/favicon.ico" type="image/x-icon">

        <link href="/assets/css/bootstrap.min.css" rel="stylesheet" />
        <link href="/assets/css/highlight.css" rel="stylesheet">
        <link href="/assets/css/clean-blog.css" rel="stylesheet" />
        <link href="/assets/css/master.css" rel="stylesheet" />
        <link href="/assets/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
        <link href="/assets/css/override.css" rel="stylesheet" />


        <meta name="application-name" content="Digital Tapestry" />
        <meta name="msapplication-tooltip" content="Digital Tapestry" />
        <meta name="msapplication-starturl" content="/" />

        <meta property="og:title" content="Digital Tapestry - Understanding Task - Part I" />
        <meta property="og:type" content="website" />
        <meta property="og:url" content="https://digitaltapestry.net/posts/understanding-task-I" />
        <!-- TODO: More social graph meta tags -->

        <link href="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.css" rel="stylesheet" type="text/css">
<link href="/assets/css/atelier-sulphurpool-light.css" rel="stylesheet" />
<link href="/assets/css/overrides.css" rel="stylesheet" />

        </head>
        <body>
                
                <!-- Navigation -->
                <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
                        <div class="container-fluid">
                                <!-- Brand and toggle get grouped for better mobile display -->
                                <div class="navbar-header page-scroll">
                                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-collapse">
                                        <span class="sr-only">Toggle navigation</span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        <span class="icon-bar"></span>
                                        </button>
                                        <a class="navbar-brand" href="/">Digital Tapestry</a>
                                </div>
                        
                                <!-- Collect the nav links, forms, and other content for toggling -->
                                <div class="collapse navbar-collapse" id="navbar-collapse">
                                        <ul class="nav navbar-nav navbar-right">
                                                        <li><a href="/posts">Archive</a></li>
        <li><a href="/tags">Tags</a></li>
        <li><a href="/resume">Resume</a></li>
 
                                        </ul>
                                </div>
                                <!-- /.navbar-collapse -->
                        </div>
                        <!-- /.container -->
                </nav>
                
                <!-- Page Header -->
                <header class="intro-header" id="intro-header" style="background-image: url(&quot;/assets/images/banner_web.jpg&quot;)">
                        <div class="container">
                                <div class="row">
                                        <div class="col-md-12">

    
<div class="post-heading">
    <h1>Understanding Task - Part I</h1>
    <div class="meta">        
Published on Saturday, January 7, 2017<br>    </div>
        <div class="tags">
                    <a role="button" href="/tags/NET" class="btn btn-default btn-xs">.NET</a>
                    <a role="button" href="/tags/C%23" class="btn btn-default btn-xs">C#</a>
                    <a role="button" href="/tags/Task" class="btn btn-default btn-xs">Task</a>
                    <a role="button" href="/tags/TPL" class="btn btn-default btn-xs">TPL</a>
        </div>     
</div>
                                        </div>
                                </div>
                        </div>
                </header>
                
                <!-- Main Content -->
                <div class="container">
                        <div class="row">
                                <div id="content" class="col-md-12">
                                        

<h1 id="understanding-task">Understanding Task</h1>
<h2 id="part-i">Part I</h2>
<p>I've noticed that many developers I work and talk with have a pretty big misunderstanding of the <code>Task</code> and <code>Task&lt;T&gt;</code> types
from the Task Programming Library (TPL). In their minds a <code>Task</code> is a synonym for a <code>Thread</code>. With a bit of explanation
I can get them to almost understand that a <code>Task</code> is more often than not run on the thread pool, or represents asynchronous
I/O, but I don't get the feeling that I too often actually get them to understand this at a deep level. I think that
being able to effectively write programs with the TPL you do need this understanding, so I'm going to write a blog series
about asynchronous programming from a different point of view than most. I'm going to start from the bottom and work my
way up, while most other books/blogs/articles start at the top and work their way down, though usually not going to deep.
My hope is that by working from the bottom up, some of the mystery will just disappear.</p>
<p>I'll start by once again defining what a <code>Task</code> is at its most basic definition. A <code>Task</code> isn't something magical. Nor is
it really what the name implies: a running operation of some sort. No, a <code>Task</code> is just a simple data structure that
holds the result of something. That's it. At this point, don't even think in terms of that &ldquo;something&rdquo; being an asynchronous
operation. At it's simplest, that is not the case, and thinking in those terms right now will just confuse you and lead
you to some incorrect assumptions. Dispel this thought from your mind.</p>
<p>So, let's make this idea concrete instead of just asking you to comprehend this based solely on the claims somebody
on the Internet made. Let's actually start to build our own version of the TPL to understand this. Granted, what
we'll develop here and in future parts of this seriese will be naive implementations and a far cry from the actual
implementation in the TPL, but it will give us very deep understandings of what the TPL is all about. Remember, though,
we're building this from the bottom up. Don't try and think about where we'll be next or how we'll wind up at what
you're familiar with. Just stay with me at the stage in development that we're at.</p>
<p>So, let's create a <code>MyTask&lt;T&gt;</code>. For now we're going to ignore the non-generic version. We're also going to make the
most basic thing we can, ignoring many things that you know exist for the real <code>Task&lt;T&gt;</code>. Please, try not to think
about what you know, and just think about what we need at the simplest. From my description of what a <code>Task</code> is,
the simplest implementation for our <code>MyTask&lt;T&gt;</code> could look something like this:</p>
<pre><code class="language-csharp">public class MyTask&lt;TResult&gt;
{
    public TResult Result { get; set; }
}
</code></pre>
<p>Really, it's as simple as that. This is a data structure that represents the result of &ldquo;something&rdquo;. Most of what a
<code>Task</code> is all about is represented in the above code. Truly, I'm not trying to deceive you here, and if you're looking
for a deep understanding of the TPL, this isn't a gross oversimplification either. Yes, it is a simplification,
without a doubt, but it <em>does</em> give a very accurate representation of the concept of a <code>Task</code>. A <code>Task</code> <em>is</em>
just the result of <em>something</em>.</p>
<p>Obviously, where not done. I will contend this represents the largest portion of the concept of a <code>Task</code>, but that
doesn't mean we're done here. In fact, I've not done enough to make the light bulb click for you yet, I'm sure. At
this point you have more questions than you had before, and you're likely just thinking I'm a pretentious no-it-all
for distilling things down to this level. Bear with me. We're going to start fleshing things out now, and you'll
start to see the larger picture.</p>
<p>So, a <code>Task</code> just represents the result of <em>something</em>, but the above doesn't really go far enough to allow us to
represent the result of <em>anything</em>, or more accurately anything we'd model in a program. If nothing else, as
developers we realize most of the things we'd care to represent the result of has the potential to fail, so the
result is either successful or not. In .NET we represent failures with an <code>Exception</code>, so lets modify our code
to include this.</p>
<pre><code class="language-csharp">public class MyTask&lt;TResult&gt;
{
    public Exception Error { get; set; }

    public TResult Result { get; set; }
}
</code></pre>
<p>This is starting to more closely resemble what we're used to, but there's serious problems with this code even
at this simple level. With it coded the way it is the <code>MyTask&lt;T&gt;</code> could have <em>both</em> a <code>Result</code> and an <code>Error</code>.
We need to constrain what it can represent. We'll do that by making the type immutable. While we're at it,
let's use factory methods instead of constructors to create instances of this.</p>
<pre><code class="language-csharp">public class MyTask&lt;TResult&gt;
{
    private MyTask()
    {
    }

    public static MyTask&lt;TResult&gt; SetError(Exception e) =&gt; new MyTask&lt;TResult&gt; { Error = e };

    public static MyTask&lt;TResult&gt; SetResult(TResult result) =&gt; new MyTask&lt;TResult&gt; { Result = result };

    public Exception Error { get; private set; }

    public TResult Result { get; private set; }
}
</code></pre>
<p>There, that's it for now. Pretty simple, huh? Yeah, I know you still have questions. This code does a good
job representing my definition of a <code>Task</code>, but it's done <em>nothing</em> to turn the light bulb on yet, because
we're still missing some functionality that you know must exist. We'll come much closer to the mental model
you have next time, but in doing so I hope to also start to make you let go of that mental model and replace
it with a more accurate one.</p>


<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'digitaltapestry'; // required: replace example with your forum shortname
    var disqus_identifier = 'understanding-task-I';
    var disqus_title = 'Understanding Task - Part I';
    var disqus_url = 'https://digitaltapestry.net/posts/understanding-task-I';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                                </div>
                        </div>
                </div>
                
                <hr>
                
                <!-- Footer -->
                <footer>
                        <div class="container">
    <div class="row">
        <div class="col-md-12">
            <ul class="list-inline text-center">
                <li>
                    <a href="https://twitter.com/wekempf">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                        </span>
                    </a>
                </li>
                <li>
                    <a href="https://github.com/wekempf">
                        <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                        </span>
                    </a>
                </li>
            </ul>
            <p class="copyright text-muted">
                Copyright © 2020 by William E. Kempf. The opinions expressed herein are my own and do not represent those of my employer or any other third-party views in any way.
                <br />
                This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="license">Creative Commons Attribution 4.0 International License</a>.
                <br />
                <a href="/feed.rss"><i class="fa fa-rss"></i> RSS Feed</a> | <a href="/feed.atom"><i class="fa fa-rss"></i> Atom Feed</a>
                <br />
                <a href="https://github.com/wekempf/wekempf.github.io"><i class="fa fa-github"></i> This Site on GitHub</a>
                <br />
                Hosted on <a href="https://pages.github.com/">GitHub Pages</a>
                <br />
                <strong><a href="https://wyam.io">Generated by Wyam</a></strong>
            </p>
        </div>
    </div>
</div>
                </footer> 

                <script src="/assets/js/jquery.min.js"></script>
                <script src="/assets/js/bootstrap.min.js"></script>     
                <script src="/assets/js/highlight.pack.js"></script>   
                <script src="/assets/js/clean-blog.js"></script>
                <script src="/assets/js/d3.v3.min.js"></script>
                <script src="/assets/js/trianglify.min.js"></script>
                <script src="/assets/js/Please-compressed.js"></script>
                <script src="/assets/js/background-check.min.js"></script>

                <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
                <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
                <!--[if lt IE 9]>
                        <script src="/assets/js/html5shiv.js"></script>
                        <script src="/assets/js/respond.min.js"></script>
                <![endif]-->
                
                <script src="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.min.js"></script>
<script>mermaid.initialize({startOnLoad:true});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.16/clipboard.min.js"></script>
<script type="text/javascript">
    anchors.options.placement = 'left';
    anchors.add('#content > h1,h2,h3,h4');

    var snippets = document.querySelectorAll("pre > code");
    [].forEach.call(snippets, function(snippet) {
        snippet.insertAdjacentHTML("beforebegin", "<button class='btn-copy' data-clipboard-snippet><img class='clippy' width=13 src='/assets/images/clippy.svg' alt='Copy to clipboard'></button>");
    });
    var clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
        target: function(trigger) {
            return trigger.nextElementSibling;
        }
    });
    clipboardSnippets.on('success', function(e) {
        e.clearSelection();
        showTooltip(e.trigger, "Copied!");
    });
    clipboardSnippets.on('error', function(e) {
        showTooltip(e.trigger, fallbackMessage(e.action));
    });

    var btns = document.querySelectorAll('.btn-copy');
    for (var i = 0; i < btns.length; i++) {
        btns[i].addEventListener('mouseleave', function(e) {
            e.currentTarget.setAttribute('class', 'btn-copy');
            e.currentTarget.removeAttribute('aria-label');
        });
    }

    function showTooltip(elem, msg) {
        elem.setAttribute('class', 'btn-copy tooltipped tooltipped-s');
        elem.setAttribute('aria-label', msg);
    }

    function fallbackMessage(action) {
        var actionMsg = '';
        var actionKey = (action === 'cut' ? 'X' : 'C');
        if (/iPhone|iPad/i.test(navigator.userAgent)) {
            actionMsg = 'No support :(';
        } else if (/Mac/i.test(navigator.userAgent)) {
            actionMsg = 'Press ⌘-' + actionKey + ' to ' + action;
        } else {
            actionMsg = 'Press Ctrl-' + actionKey + ' to ' + action;
        }
        return actionMsg;
    }
    hljs.initHighlightingOnLoad();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70929529-2', 'auto');
  ga('send', 'pageview');
</script>

                <script>hljs.initHighlightingOnLoad();</script>


                <script>
                        BackgroundCheck.init({
                                targets: '.intro-header,.navbar',
                                images: '.intro-header'
                        });
                </script>
        </body>
</html>

